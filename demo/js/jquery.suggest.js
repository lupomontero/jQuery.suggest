/*!
 * jQuery.suggest() plugin.
 *
 * @author Lupo Montero <lupo@e-noise.com>
 */
(function(c){var e={def_image:"default.png",img_path:""};var a=function(f){return function(i){var h=c(this),g=h.data("suggest");i.preventDefault();f.node.val(g.value);f.node.data("suggest",g);f.suggestInput.val(g.title).hide();f.selHolder.html(g.title);f.node.trigger("select",[g]);f.selHolderWrapper.show();f.selHolderWrapper.css("display","inline-block");f.suggestList.hide()}};var b=function(f,l,h){var j,k,o,n,m,g;if(!h||!h.length){return}l.suggestList.hide().html("");for(j=0,k=h.length;j<k;j++){o=h[j];n=c("<li>");m=c("<a>");m.attr("href","#");if(o.img||f.def_image){g=c("<img>");if(!o.img){o.img=f.def_image}if(f.img_path&&!/\/$/.test(f.img_path)){f.img_path=f.img_path+"/"}g.attr("src",f.img_path+o.img);m.append(g)}if(!o.title){o.title=o.value}m.append('<h4 class="suggest-title">'+o.title+"</h4>");if(o.subtitle){m.append('<div class="suggest-subtitle">'+o.subtitle+"</div>")}m.attr("title",o.value);m.data("suggest",o);m.click(a(l));n.append(m);l.suggestList.append(n)}l.suggestList.show()};var d=function(j,i){var n={node:i,wrapper:c('<div class="suggest" style="position: relative; display: inline;">'),suggestInput:c('<input size="30">'),suggestList:c("<ul>").hide(),selHolderWrapper:c('<div class="placeholder">').hide(),selHolder:c("<div>"),selHolderCloseBtn:c('<a href="#">X</a>')},g=n.wrapper,k=n.suggestInput,f=n.suggestList,o=n.selHolderWrapper,r=n.selHolder,h=n.selHolderCloseBtn,p,q="",m=i.attr("value"),l=i.attr("title");if(j.select){i.bind("select",j.select)}if(j.clear){i.bind("clear",j.clear)}k.keydown(function(){if(p){clearTimeout(p)}});k.keyup(function(){var s=k.val();if(s===q){return}q=s;if(s.length<3){i.val("");i.removeData();f.hide();k.removeClass("suggest-loading");i.trigger("clear");return}if(p){clearTimeout(p)}k.addClass("suggest-loading");p=setTimeout(function(){var u,t;j.search&&j.search(s,function(v){k.removeClass("suggest-loading");b(j,n,v)})},500)});h.click(function(s){s.preventDefault();o.hide();k.show();f.show();if(!i.data("suggest")){k.keyup()}});o.append(r);o.append(h);g.append(k);g.append(o);g.append(f);if(m){if(!l){l=m}i.data("suggest",null);k.val(l).hide();r.html(l);o.show();o.css("display","inline-block");f.hide()}if(i.attr("class")){g.addClass(i.attr("class"))}i.hide().before(g)};c.fn.suggest=function(f){var g=c.extend({},e,f||{});c(this).each(function(h){d(g,c(this))})}}(jQuery));