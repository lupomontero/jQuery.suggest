/*!
 * jQuery.suggest() plugin.
 *
 * @author Lupo Montero <lupo@e-noise.com>
 */
(function(c){var e={def_image:"default.png",img_path:""};var a=function(f){return function(i){var h=c(this),g=h.data("suggest");i.preventDefault();f.node.val(g.value);f.node.data("suggest",g);f.suggestInput.val(g.title).hide();f.selHolder.html(g.title);f.node.trigger("select",[g]);f.selHolderWrapper.show();f.selHolderWrapper.css("display","inline-block");f.suggestList.hide()}};var b=function(f,l,h){var j,k,o,n,m,g;if(!h||!h.length){return}l.suggestList.hide().html("");for(j=0,k=h.length;j<k;j++){o=h[j];n=c("<li>");m=c("<a>");m.attr("href","#");if(o.img||f.def_image){g=c("<img>");if(!o.img){o.img=f.def_image}g.attr("src",f.img_path+"/"+o.img);m.append(g)}if(!o.title){o.title=o.value}m.append('<h4 class="suggest-title">'+o.title+"</h4>");if(o.subtitle){m.append('<div class="suggest-subtitle">'+o.subtitle+"</div>")}m.attr("title",o.value);m.data("suggest",o);m.click(a(l));n.append(m);l.suggestList.append(n)}l.suggestList.show()};var d=function(j,i){var l={node:i,wrapper:c('<div class="suggest" style="position: relative; display: inline;">'),suggestInput:c('<input size="30">'),suggestList:c("<ul>").hide(),selHolderWrapper:c('<div class="placeholder">').hide(),selHolder:c("<div>"),selHolderCloseBtn:c('<a href="#">X</a>')},g=l.wrapper,k=l.suggestInput,f=l.suggestList,m=l.selHolderWrapper,p=l.selHolder,h=l.selHolderCloseBtn,n,o="";def_value=i.attr("value"),def_title=i.attr("title");if(j.select){i.bind("select",j.select)}if(j.clear){i.bind("clear",j.clear)}k.keydown(function(){if(n){clearTimeout(n)}});k.keyup(function(){var q=k.val();if(q===o){return}o=q;if(q.length<3){i.val("");i.removeData();f.hide();k.removeClass("suggest-loading");i.trigger("clear");return}if(n){clearTimeout(n)}k.addClass("suggest-loading");n=setTimeout(function(){var s,r;j.search&&j.search(q,function(t){k.removeClass("suggest-loading");b(j,l,t)})},500)});h.click(function(q){q.preventDefault();m.hide();k.show();f.show();if(!i.data("suggest")){k.keyup()}});m.append(p);m.append(h);g.append(k);g.append(m);g.append(f);if(def_value){if(!def_title){def_title=def_value}i.data("suggest",null);k.val(def_title).hide();p.html(def_title);m.show();m.css("display","inline-block");f.hide()}i.hide().before(g)};c.fn.suggest=function(f){var g=c.extend(e,f||{});c(this).each(function(h){d(g,c(this))})}})(jQuery);